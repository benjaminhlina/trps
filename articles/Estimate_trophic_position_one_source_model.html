<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimate trophic position - one source model • trps</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate trophic position - one source model">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Estimate_trophic_position_one_source_model.html">Estimate trophic position - one source model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benjaminhlina/trps/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate trophic position - one source model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/benjaminhlina/trps/blob/main/vignettes/Estimate_trophic_position_one_source_model.Rmd" class="external-link"><code>vignettes/Estimate_trophic_position_one_source_model.Rmd</code></a></small>
      <div class="d-none name"><code>Estimate_trophic_position_one_source_model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="our-objectives">Our Objectives<a class="anchor" aria-label="anchor" href="#our-objectives"></a>
</h2>
<p>The purpose of this vignette is to learn how to estimate trophic
position of a species using stable isotope data
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">\delta^{13}C</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>).
We can estimate trophic position using a one source model based on
equations from <a href="ttps://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/0012-9658%282002%29083%5B0703%3AUSITET%5D2.0.CO%3B2">Post
2002</a>.</p>
</div>
<div class="section level2">
<h2 id="trophic-position-model">Trophic Position Model<a class="anchor" aria-label="anchor" href="#trophic-position-model"></a>
</h2>
<p>The equation for a one source model consists of the following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Trophic Position</mtext><mo>=</mo><mi>λ</mi><mo>+</mo><mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>c</mi></msub><mo>−</mo><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>b</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>Δ</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\text{Trophic Position} = \lambda + \frac{(\delta^{15}N_c - \delta^{15}N_b)}{\Delta N}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is the trophic position of the baseline (e.g., <code>2</code>),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\delta^{15}N_c</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>
of the consumer,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\delta^{15}N_b</annotation></semantics></math>
is the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>
of the baseline, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\Delta N</annotation></semantics></math>
is the trophic enrichment factor (e.g., 3.4).</p>
<p>To use this model with a Bayesian framework, we need to rearrange
this equation to the following:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>c</mi></msub><mo>=</mo><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>b</mi></msub><mo>+</mo><mi>Δ</mi><mi>N</mi><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Trophic Position</mtext><mo>−</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\delta^{15}N_c = \delta^{15}N_b + \Delta N \times (\text{Trophic Position} - \lambda) 
</annotation></semantics></math></p>
<p>The function <code><a href="../reference/one_source_model.html">one_source_model()</a></code> uses this rearranged
equation.</p>
</div>
<div class="section level2">
<h2 id="vignette-structure">Vignette structure<a class="anchor" aria-label="anchor" href="#vignette-structure"></a>
</h2>
<p>First we will need to organize the data prior to running the model.
To do this work we will use <a href="https://dplyr.tidyverse.org/" class="external-link">{dplyr}</a> and <a href="https://tidyr.tidyverse.org/" class="external-link">{tidyr}</a> but we could also use <a href="https://rdatatable.gitlab.io/data.table/" class="external-link">{data.table}</a>.</p>
<p>When running the model we will use <a href="https://benjaminhlina.github.io/trps/">{trps}</a> and <a href="https://paulbuerkner.com/brms/" class="external-link">{brms}</a> and iterative processes
provided by <a href="https://purrr.tidyverse.org/" class="external-link">{purrr}</a>.</p>
<p>Once we have run the model we will use <a href="https://mc-stan.org/bayesplot/" class="external-link">{bayesplot}</a> to assess models
and then extract posterior draws using <a href="http://mjskay.github.io/tidybayes/" class="external-link">{tidybayes}</a>. Posterior
distributions will be plotted using <a href="https://ggplot2.tidyverse.org/" class="external-link">{ggplot2}</a> and <a href="https://mjskay.github.io/ggdist/" class="external-link">{ggdist}</a> with colours
provided by <a href="https://sjmgarnier.github.io/viridis/" class="external-link">{viridis}</a>.</p>
</div>
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<p>Below we will load all the packages needed to carry out the
analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://benjaminhlina.github.io/trps/">trps</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assess-data">Assess data<a class="anchor" aria-label="anchor" href="#assess-data"></a>
</h2>
<p>In <a href="https://benjaminhlina.github.io/trps/">{trps}</a> we have
several data sets, they include stable isotope data
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">\delta^{13}C</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>)
for a consumer, lake trout (<em>Salvelinus namaycush</em>), a benthic
baseline, amphipods, and a pelagic baseline, dreissenids, for an
ecoregion in Lake Ontario.</p>
<div class="section level3">
<h3 id="consumer-data">Consumer data<a class="anchor" aria-label="anchor" href="#consumer-data"></a>
</h3>
<p>We will check out each data set with the first being the
consumer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consumer_iso</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 4</span></span></span>
<span><span class="co">#&gt;    common_name ecoregion  d13c  d15n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.9</span>  15.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.8</span>  17.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.9</span>  16.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span></code></pre></div>
<p>We can see that this data set contains the <code>common_name</code>
of the consumer , the <code>ecoregion</code> samples were collected
from, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">\delta^{13}C</annotation></semantics></math>
(<code>d13c</code>) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>
(<code>d15n</code>).</p>
</div>
<div class="section level3">
<h3 id="baseline-data">Baseline data<a class="anchor" aria-label="anchor" href="#baseline-data"></a>
</h3>
<p>Next for this vignette we will only assess and use the benthic
baseline data set.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline_1_iso</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 5</span></span></span>
<span><span class="co">#&gt;    common_name ecoregion d13c_b1 d15n_b1    id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Amphipoda   Embayment   -<span style="color: #BB0000;">26.2</span>    8.44     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Amphipoda   Embayment   -<span style="color: #BB0000;">26.6</span>    8.77     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Amphipoda   Embayment   -<span style="color: #BB0000;">26.0</span>    8.05     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Amphipoda   Embayment   -<span style="color: #BB0000;">22.1</span>   13.6      4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Amphipoda   Embayment   -<span style="color: #BB0000;">24.3</span>    6.99     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Amphipoda   Embayment   -<span style="color: #BB0000;">22.1</span>    7.95     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Amphipoda   Embayment   -<span style="color: #BB0000;">24.7</span>    7.37     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Amphipoda   Embayment   -<span style="color: #BB0000;">26.6</span>    6.93     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Amphipoda   Embayment   -<span style="color: #BB0000;">24.6</span>    6.97     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Amphipoda   Embayment   -<span style="color: #BB0000;">22.1</span>    7.95    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Amphipoda   Embayment   -<span style="color: #BB0000;">24.7</span>    7.37    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Amphipoda   Embayment   -<span style="color: #BB0000;">22.1</span>    7.95    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Amphipoda   Embayment   -<span style="color: #BB0000;">24.7</span>    7.37    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Amphipoda   Embayment   -<span style="color: #BB0000;">26.9</span>   10.2     14</span></span></code></pre></div>
<p>We can see that this data set contains the <code>common_name</code>
of the baseline, the <code>ecoregion</code> samples were collected from,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">\delta^{13}C</annotation></semantics></math>
(<code>d13c_b1</code>) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>
(<code>d15n_b1</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="organizing-data">Organizing data<a class="anchor" aria-label="anchor" href="#organizing-data"></a>
</h2>
<p>Now that we understand the data we need to combine both data sets to
estimate trophic position for our consumer.</p>
<p>To do this we first need to make an <code>id</code> column in each
data set that will assist in joining them together. We will first
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> the data by <code>ecoregion</code> and
<code>common_name</code>. Next we will <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> the same
variables, and add <code>id</code> for each grouping using
<code><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number()</a></code>. Always <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup()</a></code> the
<code>data.frame</code> after using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>. Lastly, we
will use <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code> to rearrange the order of the
columns.</p>
<div class="section level3">
<h3 id="consumer-data-1">Consumer data<a class="anchor" aria-label="anchor" href="#consumer-data-1"></a>
</h3>
<p>Let’s first add <code>id</code> to <code>consumer_iso</code> data
frame.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consumer_iso</span> <span class="op">&lt;-</span> <span class="va">consumer_iso</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">common_name</span><span class="op">:</span><span class="va">d15n</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="baseline-data-1">Baseline data<a class="anchor" aria-label="anchor" href="#baseline-data-1"></a>
</h3>
<p>Next let’s add <code>id</code> to <code>baseline_1_iso</code> data
frame. For joining purposes we are going to drop
<code>common_name</code> from this data frame.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline_1_iso</span> <span class="op">&lt;-</span> <span class="va">baseline_1_iso</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ecoregion</span><span class="op">:</span><span class="va">d15n_b1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="joining-isotope-data">Joining isotope data<a class="anchor" aria-label="anchor" href="#joining-isotope-data"></a>
</h3>
<p>Now that we have the consumer and baseline data sets in a consistent
format we can join them by <code>"id"</code> and
<code>"ecoregion"</code> using <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join()</a></code> from <a href="https://dplyr.tidyverse.org/" class="external-link">{dplyr}</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_iso_os</span> <span class="op">&lt;-</span> <span class="va">consumer_iso</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">baseline_1_iso</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"ecoregion"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can see that we have successfully combined our consumer and
baseline data. We need to do one last thing prior to analyzing the data
and that is calculate the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">\delta^{13}C</annotation></semantics></math>
(<code>c1</code>) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><mi>N</mi></mrow><annotation encoding="application/x-tex">\delta^{15}N</annotation></semantics></math>
(<code>n1</code>) for the baseline and add in the constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
(<code>l1</code>) to our data frame. We will do this by
<code>groub_by()</code> our two groups, then using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>
and <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> to calculate the mean values.</p>
<p>Important note, to run the model successfully columns need to be
named <code>d15n</code>, <code>n1</code>, and <code>l1</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_iso_os</span> <span class="op">&lt;-</span> <span class="va">combined_iso_os</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    c1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">d13c_b1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">d15n_b1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    l1 <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_iso_os</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 10</span></span></span>
<span><span class="co">#&gt;       id common_name ecoregion  d13c  d15n d13c_b1 d15n_b1    c1    n1    l1</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Lake Trout  Embayment -<span style="color: #BB0000;">22.9</span>  15.9   -<span style="color: #BB0000;">26.2</span>    8.44 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.2   -<span style="color: #BB0000;">26.6</span>    8.77 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Lake Trout  Embayment -<span style="color: #BB0000;">22.8</span>  17.0   -<span style="color: #BB0000;">26.0</span>    8.05 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6   -<span style="color: #BB0000;">22.1</span>   13.6  -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.6   -<span style="color: #BB0000;">24.3</span>    6.99 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6   -<span style="color: #BB0000;">22.1</span>    7.95 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.6   -<span style="color: #BB0000;">24.7</span>    7.37 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Lake Trout  Embayment -<span style="color: #BB0000;">22.5</span>  16.2   -<span style="color: #BB0000;">26.6</span>    6.93 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 Lake Trout  Embayment -<span style="color: #BB0000;">22.9</span>  16.4   -<span style="color: #BB0000;">24.6</span>    6.97 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 Lake Trout  Embayment -<span style="color: #BB0000;">22.3</span>  16.3   -<span style="color: #BB0000;">22.1</span>    7.95 -<span style="color: #BB0000;">24.6</span>  8.28     2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span></code></pre></div>
<p>and it is now ready to be analyzed!</p>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-analysis">Bayesian Analysis<a class="anchor" aria-label="anchor" href="#bayesian-analysis"></a>
</h2>
<p>We can now estimate trophic position for lake trout in an ecoregion
of Lake Ontario.</p>
<p>There are a few things to know about running a Bayesian analysis, I
suggest reading these resources:</p>
<ol style="list-style-type: decimal">
<li><a href="https://statswithr.github.io/book/" class="external-link">Basics of Bayesian
Statistics - Book</a></li>
<li><a href="https://www.jstatsoft.org/article/view/v080i01" class="external-link">General
Introduction to brms</a></li>
<li><a href="https://paulbuerkner.com/brms/articles/brms_nonlinear.html" class="external-link">Estimating
non-linear models with brms</a></li>
<li><a href="https://andrewproctor.github.io/rcourse/module6.html" class="external-link">Andrew
Proctor’s - Module 6</a></li>
<li><a href="https://www.nature.com/articles/s43586-020-00001-2" class="external-link">van de
Schoot et al., 2021</a></li>
</ol>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>Bayesian analyses rely on supplying uninformed or informed prior
distributions for each parameter (coefficient; predictor) in the model.
The default informed priors for a one source model are the following,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\Delta N</annotation></semantics></math>
assumes a normal distribution (<code>dn</code>;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>3.4</mn></mrow><annotation encoding="application/x-tex">\mu = 3.4</annotation></semantics></math>;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">\sigma = 0.25</annotation></semantics></math>),
trophic position assumes a uniform distribution (lower bound = 2 and
upper bound = 10),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
assumes a uniform distribution (lower bound = 0 and upper bound = 10)
and if informed priors are desired for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mn>15</mn></msup><msub><mi>N</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\delta^{15}N_b</annotation></semantics></math>
(<code>n1</code>;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>9</mn></mrow><annotation encoding="application/x-tex">\mu = 9</annotation></semantics></math>;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma = 1</annotation></semantics></math>),
we can set the argument <code>bp</code> to <code>TRUE</code> in all
<code>one_source_</code> functions.</p>
<p>You can change these default priors using
<code><a href="../reference/one_source_priors_params.html">one_source_priors_params()</a></code>, however, I would suggest
becoming familiar with Bayesian analyses, your study species, and system
prior to adjusting these values.</p>
</div>
<div class="section level3">
<h3 id="model-convergence">Model convergence<a class="anchor" aria-label="anchor" href="#model-convergence"></a>
</h3>
<p>Some important things to pay attention to are always run at least 2
chains, if the model does not converge you can try to increase the
following:</p>
<ol style="list-style-type: decimal">
<li><p>The amount of samples that are burned-in (discarded; in
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> this can be controlled by the argument
<code>warmup</code>)</p></li>
<li><p>The number of iterative samples retained (in <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code>
this can be controlled by the argument <code>iter</code>).</p></li>
<li><p>The number of samples drawn (in <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> this is
controlled by the argument <code>thin</code>).</p></li>
<li><p>Adjust the <code>adapt_delta</code> value using
<code>control = list(adapt_delta = 0.95)</code>.</p></li>
</ol>
<p>When assessing the model we want R-hat to be 1 or within 0.05 of 1,
which indicates that the variance among and within chains is equal (See
<a href="https://mc-stan.org/rstan/reference/Rhat.html" class="external-link">{rstan}
docmentation on R-hat</a>), a high value for effective sample size
(ESS), trace plots to look “grassy” or “caterpillar like”, and posterior
distributions to look relatively normal.</p>
</div>
</div>
<div class="section level2">
<h2 id="estimating-trophic-position">Estimating trophic position<a class="anchor" aria-label="anchor" href="#estimating-trophic-position"></a>
</h2>
<p>We will use functions from <a href="https://benjaminhlina.github.io/trps/">{trps}</a> that drop into a
<a href="https://paulbuerkner.com/brms/" class="external-link">{brms}</a> model. These
functions are <code><a href="../reference/one_source_model.html">one_source_model()</a></code> which provides
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> the formula structure needed to run a one source
model. Next <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> needs the structure of the priors which
is supplied to the <code>prior</code> argument using
<code><a href="../reference/one_source_priors.html">one_source_priors()</a></code>. Lastly, values for these priors are
supplied through the <code>stanvars</code> argument using
<code><a href="../reference/one_source_priors_params.html">one_source_priors_params()</a></code>. You can adjust the mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>),
variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>),
or upper and lower bounds (<code>lb</code> and <code>ub</code>) for each
prior of the model using <code><a href="../reference/one_source_priors_params.html">one_source_priors_params()</a></code>,
however, only adjust priors if you have a good grasp of Bayesian
frameworks and your study system and species.</p>
<div class="section level3">
<h3 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h3>
<p>Let’s run the model!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="../reference/one_source_model.html">one_source_model</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="../reference/one_source_priors.html">one_source_priors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  stanvars <span class="op">=</span> <span class="fu"><a href="../reference/one_source_priors_params.html">one_source_priors_params</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">combined_iso_os</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-output">Model output<a class="anchor" aria-label="anchor" href="#model-output"></a>
</h3>
<p>Let’s view the summary of the model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: combined_iso_os (Number of observations: 30) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.37      0.25     2.89     3.86 1.00     1506     1878</span></span>
<span><span class="co">#&gt; tp_Intercept     4.54      0.20     4.21     4.96 1.00     1531     1891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.61      0.09     0.47     0.81 1.00     2145     1903</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>We can see that the R-hat is 1 meaning that variance among and within
chains is equal (See <a href="https://mc-stan.org/rstan/reference/Rhat.html" class="external-link">{rstan}
docmentation on R-hat</a>) and that ESS is quite large. Overall, this
means the model is converging and fitting accordingly.</p>
</div>
<div class="section level3">
<h3 id="trace-plots">Trace plots<a class="anchor" aria-label="anchor" href="#trace-plots"></a>
</h3>
<p>Let’s view trace plots and posterior distributions for the model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can see that the trace plots look “grassy” meaning the model is
converging!</p>
</div>
</div>
<div class="section level2">
<h2 id="posterior-draws">Posterior draws<a class="anchor" aria-label="anchor" href="#posterior-draws"></a>
</h2>
<p>Let’s again look at the summary output from the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: combined_iso_os (Number of observations: 30) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.37      0.25     2.89     3.86 1.00     1506     1878</span></span>
<span><span class="co">#&gt; tp_Intercept     4.54      0.20     4.21     4.96 1.00     1531     1891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.61      0.09     0.47     0.81 1.00     2145     1903</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>We can see that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\Delta N</annotation></semantics></math>
is estimated to be <code>3.37</code> with <code>l-95% CI</code> of
<code>2.89</code>, and <code>u-95% CI</code> of <code>3.86</code>. If we
move down to trophic position (<code>tp</code>) we see trophic position
is estimated to be <code>4.54</code> with <code>l-95% CI</code> of
<code>4.21</code>, and <code>u-95% CI</code> of <code>4.96</code>.</p>
<div class="section level3">
<h3 id="extract-posterior-draws">Extract posterior draws<a class="anchor" aria-label="anchor" href="#extract-posterior-draws"></a>
</h3>
<p>We will use functions from <a href="http://mjskay.github.io/tidybayes/" class="external-link">{tidybayes}</a> to do this
work. First we will look at the the names of the variables we want to
extract using <code><a href="https://mjskay.github.io/tidybayes/reference/get_variables.html" class="external-link">get_variables()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/get_variables.html" class="external-link">get_variables</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "b_dn_Intercept" "b_tp_Intercept" "sigma"          "lprior"        </span></span>
<span><span class="co">#&gt;  [5] "lp__"           "accept_stat__"  "stepsize__"     "treedepth__"   </span></span>
<span><span class="co">#&gt;  [9] "n_leapfrog__"   "divergent__"    "energy__"</span></span></code></pre></div>
<p>You will notice that <code>"b_tp_Intercept"</code> is the name of the
variable<br>
that we are wanting to extract. We then will extract posterior draws
using <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws()</a></code>. We going to rename
<code>"b_tp_Intercept"</code> to <code>tp</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_draws</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws</a></span><span class="op">(</span><span class="va">b_tp_Intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ecoregion <span class="op">=</span> <span class="st">"Embayment"</span>,</span>
<span>    common_name <span class="op">=</span> <span class="st">"Lake Trout"</span>,</span>
<span>    .variable <span class="op">=</span> <span class="st">"tp"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">common_name</span>, <span class="va">ecoregion</span>, <span class="va">.chain</span><span class="op">:</span><span class="va">.value</span><span class="op">)</span></span></code></pre></div>
<p>Let’s view the <code>post_draws</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_draws</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6,000 × 7</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   .variable [1]</span></span></span>
<span><span class="co">#&gt;    common_name ecoregion .chain .iteration .draw .variable .value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Lake Trout  Embayment      1          1     1 tp          4.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Lake Trout  Embayment      1          2     2 tp          4.26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Lake Trout  Embayment      1          3     3 tp          4.39</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Lake Trout  Embayment      1          4     4 tp          4.44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Lake Trout  Embayment      1          5     5 tp          4.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Lake Trout  Embayment      1          6     6 tp          4.74</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Lake Trout  Embayment      1          7     7 tp          5.06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Lake Trout  Embayment      1          8     8 tp          4.40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Lake Trout  Embayment      1          9     9 tp          4.42</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Lake Trout  Embayment      1         10    10 tp          4.30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,990 more rows</span></span></span></code></pre></div>
<p>We can see that this consists of seven variables:</p>
<ol style="list-style-type: decimal">
<li><code>ecoregion</code></li>
<li><code>common_name</code></li>
<li><code>.chain</code></li>
<li>
<code>.iteration</code>(number sampled after burn-in)</li>
<li>
<code>.draw</code> (number sampled from <code>iter</code>; adjusted
using <code>thin</code>)</li>
<li>
<code>.variable</code> (this will have different variables depending
on what is supplied to <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws()</a></code>)</li>
<li>
<code>.value</code> (estimated value)</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="extracting-credible-intervals">Extracting credible intervals<a class="anchor" aria-label="anchor" href="#extracting-credible-intervals"></a>
</h2>
<p>Considering we are likely using this information for a paper or
presentation, it is nice to be able to report the median and credible
intervals (e.g., equal-tailed intervals; ETI). We can extract and export
these values using <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">spread_draws()</a></code> and
<code>median_qi</code> from <a href="http://mjskay.github.io/tidybayes/" class="external-link">{tidybayes}</a>.</p>
<p>I have renamed <code>b_tp_Intercept</code> to <code>tp</code>, added
the grouping columns, rounded all columns that are numeric to two
decimal points using <code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if()</a></code> and rearranged the order
of the columns using <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medians_ci</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">spread_draws</a></span><span class="op">(</span><span class="va">b_tp_Intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">median_qi</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>          tp <span class="op">=</span> <span class="va">b_tp_Intercept</span></span>
<span>        <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ecoregion <span class="op">=</span> <span class="st">"Embayment"</span>, </span>
<span>    common_name <span class="op">=</span> <span class="st">"Lake Trout"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span>, <span class="va">tp</span><span class="op">:</span><span class="va">.interval</span><span class="op">)</span></span></code></pre></div>
<p>Let’s view the output.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medians_ci</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">#&gt;   ecoregion common_name    tp .lower .upper .width .point .interval</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Embayment Lake Trout   4.53   4.21   4.96   0.95 median qi</span></span></code></pre></div>
<p>I like to use <a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">{openxlsx}</a> to
export these values into a table that I can use for presentations and
papers. For the vignette I am not going to demonstrate how to do this
but please check out <a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a>.</p>
</div>
<div class="section level2">
<h2 id="ploting-posterior-distributions">Ploting posterior distributions<a class="anchor" aria-label="anchor" href="#ploting-posterior-distributions"></a>
</h2>
<p>Now that we have our posterior draws extracted we can plot them. For
comparing trophic position among species or groups, I like using either
violin plots, interval points, or slab plots for posteriors. We can
access violins through <a href="https://ggplot2.tidyverse.org/" class="external-link">{ggplot2}</a> with the later being
available in <a href="https://mjskay.github.io/ggdist/" class="external-link">{ggdist}</a>.</p>
<div class="section level3">
<h3 id="density-plot">Density plot<a class="anchor" aria-label="anchor" href="#density-plot"></a>
</h3>
<p>For this example we first are going to plot the density for posterior
draws using <code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">post_draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"P(Trophic Position | X)"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="point-interval">Point interval<a class="anchor" aria-label="anchor" href="#point-interval"></a>
</h3>
<p>Next as a point interval plot using
<code><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">post_draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.value</span>, </span>
<span>                              x <span class="op">=</span> <span class="va">common_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"P(Trophic Position | X)"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Congratulations we have estimate trophic position for Lake Trout!</p>
<p>I’ll demonstrate below how to run the model with an iterative process
to produce estimates of trophic position for more than one group (e.g.,
comparing trophic position among species or in this case different
ecoergion).</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-multiple-groups">Working with multiple groups<a class="anchor" aria-label="anchor" href="#working-with-multiple-groups"></a>
</h2>
<p>In <a href="https://benjaminhlina.github.io/trps/">{trps}</a> we have
a data set that has consumer and baseline data already joined for two
ecoregions (<code>combined_iso</code>) using the same methods above.
Let’s look at this data frame.</p>
<div class="section level3">
<h3 id="organize-data---multiple-groups">Organize data - multiple groups<a class="anchor" aria-label="anchor" href="#organize-data---multiple-groups"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_iso</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 117 × 13</span></span></span>
<span><span class="co">#&gt;       id common_name ecoregion  d13c  d15n d13c_b1 d15n_b1 d13c_b2 d15n_b2    c1</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Lake Trout  Anthropo… -<span style="color: #BB0000;">22.3</span>  17.6   -<span style="color: #BB0000;">20.3</span>    8.85   -<span style="color: #BB0000;">26.4</span>    7.72 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Lake Trout  Anthropo… -<span style="color: #BB0000;">23.0</span>  17.7   -<span style="color: #BB0000;">20.1</span>    8.77   -<span style="color: #BB0000;">24.4</span>    8.69 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Lake Trout  Anthropo… -<span style="color: #BB0000;">21.2</span>  16.7   -<span style="color: #BB0000;">20.3</span>    8.85   -<span style="color: #BB0000;">24.8</span>    7.99 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Lake Trout  Anthropo… -<span style="color: #BB0000;">20.9</span>  18.7   -<span style="color: #BB0000;">20.1</span>    8.77   -<span style="color: #BB0000;">24.4</span>    8.69 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Lake Trout  Anthropo… -<span style="color: #BB0000;">20.7</span>  18.0   -<span style="color: #BB0000;">20.5</span>    8.38   -<span style="color: #BB0000;">24.8</span>    7.99 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Lake Trout  Anthropo… -<span style="color: #BB0000;">20.7</span>  18.0   -<span style="color: #BB0000;">20.1</span>    8.34   -<span style="color: #BB0000;">24.4</span>    8.05 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Lake Trout  Anthropo… -<span style="color: #BB0000;">22.8</span>  17.8   -<span style="color: #BB0000;">19.7</span>    8.04   -<span style="color: #BB0000;">24.1</span>    8.79 -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Lake Trout  Anthropo… -<span style="color: #BB0000;">22.4</span>  17.9   -<span style="color: #BB0000;">20.1</span>    8.56   -<span style="color: #BB0000;">24.6</span>   10.7  -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 Lake Trout  Anthropo… -<span style="color: #BB0000;">20.9</span>  18.4   -<span style="color: #BB0000;">18.7</span>    8.95   -<span style="color: #BB0000;">24.3</span>   10.6  -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 Lake Trout  Anthropo… -<span style="color: #BB0000;">21.7</span>  17.7   -<span style="color: #BB0000;">20.8</span>    9.28   -<span style="color: #BB0000;">24.6</span>   10.7  -<span style="color: #BB0000;">21.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 107 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: n1 &lt;dbl&gt;, c2 &lt;dbl&gt;, n2 &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We can see that this data frame has isotope data for a second
baseline (dreissenids; <code>d13c_b2</code> and <code>d15n_b2</code>) as
well as the mean values for both baselines
(<code>c1</code>-<code>n2</code>). These columns for the second baseline
are useful when estimating trophic position using a two source model but
we do not need them for this analysis and they can be removed.</p>
<p>We can also confirm that this data set has one species, lake
trout.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">combined_iso</span><span class="op">$</span><span class="va">common_name</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Lake Trout</span></span>
<span><span class="co">#&gt; Levels: Lake Trout</span></span></code></pre></div>
<p>collected from two ecoregions in Lake Ontario.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">combined_iso</span><span class="op">$</span><span class="va">ecoregion</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Anthropogenic Embayment    </span></span>
<span><span class="co">#&gt; Levels: Anthropogenic Embayment</span></span></code></pre></div>
<p>Let’s remove the columns we don’t need, <code>d13c_b2</code>,
<code>d15n_b2</code>, <code>c2</code>, <code>n2</code>. We also need to
add
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
to the data frame (<code>l1</code>). We are going to make a
<code>name</code> column that will be the two groups we have
<code>common_name</code> and <code>ecoregion</code> pasted together. We
are doing this to make the iterative processes easier.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_iso_update</span> <span class="op">&lt;-</span> <span class="va">combined_iso</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d13c_b2</span>, <span class="va">d15n_b2</span>, <span class="va">c2</span>, <span class="va">n2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    l1 <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ecoregion</span>, <span class="va">common_name</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">common_name</span>, <span class="va">ecoregion</span>, <span class="va">name</span>, <span class="va">d13c</span><span class="op">:</span><span class="va">l1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_iso_update</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 117 × 11</span></span></span>
<span><span class="co">#&gt;       id common_name ecoregion     name   d13c  d15n d13c_b1 d15n_b1    c1    n1</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">22.3</span>  17.6   -<span style="color: #BB0000;">20.3</span>    8.85 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">23.0</span>  17.7   -<span style="color: #BB0000;">20.1</span>    8.77 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">21.2</span>  16.7   -<span style="color: #BB0000;">20.3</span>    8.85 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">20.9</span>  18.7   -<span style="color: #BB0000;">20.1</span>    8.77 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">20.7</span>  18.0   -<span style="color: #BB0000;">20.5</span>    8.38 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">20.7</span>  18.0   -<span style="color: #BB0000;">20.1</span>    8.34 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">22.8</span>  17.8   -<span style="color: #BB0000;">19.7</span>    8.04 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">22.4</span>  17.9   -<span style="color: #BB0000;">20.1</span>    8.56 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">20.9</span>  18.4   -<span style="color: #BB0000;">18.7</span>    8.95 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 Lake Trout  Anthropogenic Anth… -<span style="color: #BB0000;">21.7</span>  17.7   -<span style="color: #BB0000;">20.8</span>    9.28 -<span style="color: #BB0000;">21.3</span>  8.14</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 107 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: l1 &lt;dbl&gt;</span></span></span></code></pre></div>
<p>This example data is now ready to be analyzed.</p>
</div>
</div>
<div class="section level2">
<h2 id="estimate-trophic-position---multiple-groups">Estimate trophic position - multiple groups<a class="anchor" aria-label="anchor" href="#estimate-trophic-position---multiple-groups"></a>
</h2>
<p>We will use similar structure as before to model trophic position,
however, we will first <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code> the data into a list for all
groups and then use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> from <a href="https://purrr.tidyverse.org/" class="external-link">{purrr}</a> to run the model for
each group.</p>
<p>You will notice that the <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> call is exactly the same
as when we ran the model for one group. The only difference here is when
using <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code>, the <code>data</code> argument in
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> needs to be replaced with <code>.x</code> to tell
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm()</a></code> where to get the data.</p>
<div class="section level3">
<h3 id="model---multiple-groups">Model - multiple groups<a class="anchor" aria-label="anchor" href="#model---multiple-groups"></a>
</h3>
<p>Let’s run the model!</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">combined_iso_update</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="fu"><a href="../reference/one_source_model.html">one_source_model</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="../reference/one_source_priors.html">one_source_priors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    stanvars <span class="op">=</span> <span class="fu"><a href="../reference/one_source_priors_params.html">one_source_priors_params</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>    warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, </span>
<span>  .progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span>
<span><span class="co">#&gt;  <span style="color: #00BB00;">■■■■■■■■■■■■■■■■                </span>  50% |  ETA:  1m</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-output---multiple-groups">Model output - multiple groups<a class="anchor" aria-label="anchor" href="#model-output---multiple-groups"></a>
</h3>
<p>Let’s look at the summary of both models.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span></span>
<span><span class="co">#&gt; $`Anthropogenic_Lake Trout`</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: .x (Number of observations: 87) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.38      0.26     2.88     3.87 1.00     1645     1794</span></span>
<span><span class="co">#&gt; tp_Intercept     4.82      0.22     4.44     5.29 1.00     1644     1818</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.48      0.04     0.42     0.57 1.00     2124     2125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Embayment_Lake Trout`</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: .x (Number of observations: 30) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.37      0.25     2.89     3.86 1.00     1506     1878</span></span>
<span><span class="co">#&gt; tp_Intercept     4.54      0.20     4.21     4.96 1.00     1531     1891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.61      0.09     0.47     0.81 1.00     2145     1903</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>We can see that the R-hat is 1, meaning that the variance among and
within chains is equal (See <a href="https://mc-stan.org/rstan/reference/Rhat.html" class="external-link">{rstan}
docmentation on R-hat</a>) and that ESS is quite large for both groups.
Overall, this means the both models are converging and fitting
accordingly.</p>
</div>
<div class="section level3">
<h3 id="trace-plots---multiple-groups">Trace plots - multiple groups<a class="anchor" aria-label="anchor" href="#trace-plots---multiple-groups"></a>
</h3>
<p>Let’s look at the trace plots and distributions. We will use
<code><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">iwalk()</a></code> instead of <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> here as
<code><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">iwalk()</a></code> invisibly return <code>.x</code> which is handy
when you want to call a function (e.g., <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>) for its
side effects rather than its returned value. I have also added
<code><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text()</a></code> from {grid} to add the group names to each
plot.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">iwalk</a></span><span class="op">(</span><span class="op">~</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span><span class="va">.y</span>, x <span class="op">=</span> <span class="fl">0.5</span>, y <span class="op">=</span> <span class="fl">0.98</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-25-1.png" width="700"><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-25-2.png" width="700"></p>
<p>We can see that the trace plots look “grassy” meaning the model is
converging!</p>
</div>
</div>
<div class="section level2">
<h2 id="posterior-draws---multiple-groups">Posterior draws - multiple groups<a class="anchor" aria-label="anchor" href="#posterior-draws---multiple-groups"></a>
</h2>
<p>Let’s again look at the summary output from the model.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span></span>
<span><span class="co">#&gt; $`Anthropogenic_Lake Trout`</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: .x (Number of observations: 87) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.38      0.26     2.88     3.87 1.00     1645     1794</span></span>
<span><span class="co">#&gt; tp_Intercept     4.82      0.22     4.44     5.29 1.00     1644     1818</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.48      0.04     0.42     0.57 1.00     2124     2125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Embayment_Lake Trout`</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: d15n ~ n1 + dn * (tp - l1) </span></span>
<span><span class="co">#&gt;          dn ~ 1</span></span>
<span><span class="co">#&gt;          tp ~ 1</span></span>
<span><span class="co">#&gt;    Data: .x (Number of observations: 30) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 6000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; dn_Intercept     3.37      0.25     2.89     3.86 1.00     1506     1878</span></span>
<span><span class="co">#&gt; tp_Intercept     4.54      0.20     4.21     4.96 1.00     1531     1891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.61      0.09     0.47     0.81 1.00     2145     1903</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>We can see for lake trout from the <code>Anthropogenic</code>
ecoregion that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\Delta N</annotation></semantics></math>
is estimated to be <code>3.38</code> with <code>l-95% CI</code> of
<code>2.88</code>, and <code>u-95% CI</code> of <code>3.87</code>. If we
move down to trophic position (<code>tp</code>) we see trophic position
is estimated to be <code>4.82</code> with <code>l-95% CI</code> of
<code>4.44</code>, and <code>u-95% CI</code> of <code>5.29</code>.</p>
<p>We can see for lake trout from the <code>Embayment</code> ecoregion
that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\Delta N</annotation></semantics></math>
is estimated to be <code>3.37</code> with <code>l-95% CI</code> of
<code>2.89</code>, and <code>u-95% CI</code> of <code>3.86</code>. If we
move down to trophic position (<code>tp</code>) we see trophic position
is estimated to be <code>4.54</code> with <code>l-95% CI</code> of
<code>4.21</code>, and <code>u-95% CI</code> of <code>4.96</code>.</p>
<div class="section level3">
<h3 id="extract-posterior-draws---multiple-groups">Extract posterior draws - multiple groups<a class="anchor" aria-label="anchor" href="#extract-posterior-draws---multiple-groups"></a>
</h3>
<p>We will use functions from <a href="http://mjskay.github.io/tidybayes/" class="external-link">{tidybayes}</a> to do this
work. First we will look at the the names of the variables we want to
extract using <code><a href="https://mjskay.github.io/tidybayes/reference/get_variables.html" class="external-link">get_variables()</a></code>. Considering we have multiple
models in <code>m1</code> that have all of the same structure we can
just look at the names of the first model object in <code>m1</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/get_variables.html" class="external-link">get_variables</a></span><span class="op">(</span><span class="va">m1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "b_dn_Intercept" "b_tp_Intercept" "sigma"          "lprior"        </span></span>
<span><span class="co">#&gt;  [5] "lp__"           "accept_stat__"  "stepsize__"     "treedepth__"   </span></span>
<span><span class="co">#&gt;  [9] "n_leapfrog__"   "divergent__"    "energy__"</span></span></code></pre></div>
<p>You will notice that <code>"b_tp_Intercept"</code> is the name of the
variable<br>
that we are wanting to extract. We then will extract posterior draws
using <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws()</a></code>. We going to rename
<code>"b_tp_Intercept"</code> to <code>tp</code>.</p>
<p>Again, considering we have multiple models in <code>m1</code> we need
to use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> to iterate over <code>m1</code> to get the
posterior draws. Once we have iterated over <code>m1</code> to extract
draws we can combine the results using <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows()</a></code> from <a href="https://dplyr.tidyverse.org/" class="external-link">{dplyr}</a>. The variable
<code>name</code> will have the name of the ecoregion and common name of
the species, however, they will pasted to together by a <code>_</code>.
We need separate this string into the two variables we want
<code>ecoregion</code> and <code>common_name</code>. We can do this by
using <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim()</a></code> from <a href="https://tidyr.tidyverse.org/" class="external-link">{tidyr}</a>. When using this
function it will separate the columns and keep them as
<code>characters</code>, hence why the last step is to convert
<code>ecoregion</code> into a <code>factor</code>.</p>
<p>For your data you will likley have other catogory names than
<code>ecoregion</code> and <code>common_name</code>. Please replace with
the columns that fit your data structure.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_draws_mg</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws</a></span><span class="op">(</span><span class="va">b_tp_Intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          .variable <span class="op">=</span> <span class="st">"tp"</span></span>
<span>        <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">name</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ecoregion"</span>, <span class="st">"common_name"</span><span class="op">)</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">"_"</span>, cols_remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ecoregion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ecoregion</span>, </span>
<span>                       levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Anthropogenic"</span>, <span class="st">"Embayment"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Let’s view the <code>post_draws_mg</code></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_draws_mg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12,000 × 8</span></span></span>
<span><span class="co">#&gt;    ecoregion     common_name name       .chain .iteration .draw .variable .value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Anthropogenic Lake Trout  Anthropog…      1          1     1 tp          4.49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Anthropogenic Lake Trout  Anthropog…      1          2     2 tp          4.90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Anthropogenic Lake Trout  Anthropog…      1          3     3 tp          4.74</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Anthropogenic Lake Trout  Anthropog…      1          4     4 tp          4.87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Anthropogenic Lake Trout  Anthropog…      1          5     5 tp          4.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Anthropogenic Lake Trout  Anthropog…      1          6     6 tp          5.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Anthropogenic Lake Trout  Anthropog…      1          7     7 tp          5.16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Anthropogenic Lake Trout  Anthropog…      1          8     8 tp          5.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Anthropogenic Lake Trout  Anthropog…      1          9     9 tp          4.94</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Anthropogenic Lake Trout  Anthropog…      1         10    10 tp          4.95</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11,990 more rows</span></span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<code>ecoregion</code>,</li>
<li>
<code>common_name</code>,</li>
<li>
<code>.chain</code>,</li>
<li>
<code>.iteration</code>(number sampled after burn-in),</li>
<li>
<code>.draw</code> (number sampled from <code>iter</code>; adjusted
using <code>thin</code>),</li>
<li>
<code>.variable</code> (this will have different variables depending
on what is supplied to <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">gather_draws()</a></code>),</li>
<li>
<code>.value</code> (estimated value).</li>
</ol>
<p>Note - the names of and items in the first two columns will vary
depending on the names you split your data into.</p>
</div>
</div>
<div class="section level2">
<h2 id="extracting-credible-intervals---multiple-groups">Extracting credible intervals - multiple groups<a class="anchor" aria-label="anchor" href="#extracting-credible-intervals---multiple-groups"></a>
</h2>
<p>Considering we are likely using this information for a paper or
presentation, it is nice to be able to report the median and credible
intervals (e.g., equal-tailed intervals; ETI). We can extract and export
these values using <code><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">spread_draws()</a></code> and
<code>median_qi</code> from <a href="http://mjskay.github.io/tidybayes/" class="external-link">{tidybayes}</a>.</p>
<p>Again, <code>m1</code> is a <code>list</code>of our model objects, we
need to <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> over the list to calculate these. Then we
will do the same procedures we have done before in combining our outputs
and get the names of each group correct. Lastly, we will use
<code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if()</a></code> to round all columns that are numeric to two
decimal points.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_medians_ci</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/spread_draws.html" class="external-link">spread_draws</a></span><span class="op">(</span><span class="va">b_tp_Intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">median_qi</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>          tp <span class="op">=</span> <span class="va">b_tp_Intercept</span></span>
<span>        <span class="op">)</span> </span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">name</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ecoregion"</span>, <span class="st">"common_name"</span><span class="op">)</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">"_"</span>, cols_remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ecoregion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ecoregion</span>, </span>
<span>                       levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Anthropogenic"</span>, <span class="st">"Embayment"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Let’s view the output.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_medians_ci</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 9</span></span></span>
<span><span class="co">#&gt;   ecoregion     common_name name        tp .lower .upper .width .point .interval</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Anthropogenic Lake Trout  Anthrop…  4.81   4.44   5.29   0.95 median qi       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Embayment     Lake Trout  Embayme…  4.53   4.21   4.96   0.95 median qi</span></span></code></pre></div>
<p>I like to use <a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">{openxlsx}</a> to
export these values into a table that I can use for presentations and
papers. For the vignette I am not going to demonstrate how to do this
but please check out <a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a>.</p>
</div>
<div class="section level2">
<h2 id="ploting-posterior-distributions---multiple-groups">Ploting posterior distributions - multiple groups<a class="anchor" aria-label="anchor" href="#ploting-posterior-distributions---multiple-groups"></a>
</h2>
<p>Now that we have our posterior draws extracted we can plot them. For
comparing trophic position among species or groups, I like using either
violin plots, interval points, or slab plots for posteriors. We can
access violins through <a href="https://ggplot2.tidyverse.org/" class="external-link">{ggplot2}</a> with the later being
available in <a href="https://mjskay.github.io/ggdist/" class="external-link">{ggdist}</a>.</p>
<div class="section level3">
<h3 id="violin-plot">Violin plot<a class="anchor" aria-label="anchor" href="#violin-plot"></a>
</h3>
<p>Let’s first look at the violin plot.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">post_draws_mg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">common_name</span>, </span>
<span>                                 y <span class="op">=</span> <span class="va">.value</span>, </span>
<span>                                 fill <span class="op">=</span> <span class="va">ecoregion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">median</span>, geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>               size <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Ecoregion"</span>, </span>
<span>                       option <span class="op">=</span> <span class="st">"G"</span>, </span>
<span>                       begin <span class="op">=</span> <span class="fl">0.35</span>, </span>
<span>                       end <span class="op">=</span> <span class="fl">0.75</span>, alpha <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>, </span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.86</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"P(Trophic Position | X)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="point-interval-plot">Point interval plot<a class="anchor" aria-label="anchor" href="#point-interval-plot"></a>
</h3>
<p>Next, let’s look at the point interval plot but first we need to
create our colour palette.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">viridis_colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">2</span>,</span>
<span>                           option <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>                           begin <span class="op">=</span> <span class="fl">0.35</span>, </span>
<span>                           end <span class="op">=</span> <span class="fl">0.75</span>, </span>
<span>                           alpha <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s plot the point intervals.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">post_draws_mg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">common_name</span>, </span>
<span>                                 y <span class="op">=</span> <span class="va">.value</span>, </span>
<span>                                 group <span class="op">=</span> <span class="va">ecoregion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>point_fill <span class="op">=</span> <span class="va">ecoregion</span><span class="op">)</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    interval_colour <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="st">"point_fill"</span>,</span>
<span>                    values <span class="op">=</span> <span class="va">viridis_colours</span>,</span>
<span>                    name <span class="op">=</span> <span class="st">"Ecoregion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>, </span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.86</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"P(Trophic Position | X)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Estimate_trophic_position_one_source_model_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>Congratulations we have successfully run a Bayesian one source
trophic position model for one species in two ecoregions of Lake
Ontario!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin L. Hlina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
